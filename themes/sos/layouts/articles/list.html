{{/*Here is defined the default iterator page (_index.md) for the articles folder where all the posts are it includes 
  the content of index.md and then iteratore over thew post in the folder  */}}
{{ define "main" }}
  <article class="narrow-content" >
    <section>
      {{- .Content -}}
    </section>

    {{ $currentSection := .Section }}
    {{ $articles := slice }}
    
    {{ range .Site.RegularPages }}
        {{ if or (eq .Section $currentSection) (in .Sections $currentSection) }}
            {{ $articles = $articles | append . }}
        {{ end }}
    {{ end }}
    
    {{ $allTags := slice }}
    {{ range $articles }}
        {{ $tags := .Params.tags }}
        {{ $allTags = union $allTags $tags }}
    {{ end }}

    <section class="articles">
      {{ range $allTags }}
          {{ $currentTag := . }}
          <h1><a href="/tags/{{  . | urlize }}">{{ . }}</a></h1>
          <ul class="articles__list">
          {{ range $articles }}
              {{ $articleTags := .Params.tags }}
              {{ if in $articleTags $currentTag }}
              <div class="articles__list__entry">
                {{ .Render "summary" }}
              </div>
              {{ end }}
          {{ end }}
        </ul>
      {{ end }}
      
    </section>
  </article>
{{ end }}